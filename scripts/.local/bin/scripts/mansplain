#!/bin/zsh
# -----------------------------------------------------------------------------
# MANSPLAIN
#
# PDF enabled manual viewer.
#
# Shows a rofi prompt if called with no arguments (shows just user commands and
# configuration file entries.). Otherwise attempts to open the specified page.
# Searches are remembered, and the prompt will order them by search frequency.
#
# Inspired by Luke Smith: https://youtu.be/8E8sUNHdzG8
# -----------------------------------------------------------------------------

# Configure recency cache.
DB="$XDG_CACHE_HOME/dotfiles/mansplain.db"
[ -f "$DB" ] || frece init "$DB" <(man -s 1,5 -k . | awk '{print $1}')

# Get the manual entry.
MAN=${1:=$(frece print "$DB" | rofi -dmenu -theme vmenu -columns 5 -p "Help:")}
[ -n "$MAN" ] || exit

# Update counter and display output
frece increment "$DB" "$MAN"
man -Tpdf "$MAN" | zathura - &
